"use strict";"undefined"!=typeof module&&module.exports&&(module.exports.inject=function(e){return new AuthenticationContext(e)}),function(){if(angular){var e=angular.module("AdalAngular",[]);e.provider("adalAuthenticationService",function(){var e=null,r={isAuthenticated:!1,userName:"",loginError:"",profile:""},o=function(o){var n=e.getCachedToken(o);r.isAuthenticated=null!==n&&n.length>0;var t=e.getCachedUser()||{userName:""};r.userName=t.userName,r.profile=t.profile,r.loginError=e.getLoginError()};this.init=function(r,n){if(!r)throw new Error("You must set configOptions, when calling init");var t=window.location.hash,i=window.location.href;t&&(i=i.replace(t,"")),r.redirectUri=r.redirectUri||i,r.postLogoutRedirectUri=r.postLogoutRedirectUri||i,n&&n.interceptors&&n.interceptors.push("ProtectedResourceInterceptor"),e=new AuthenticationContext(r),o(e.config.loginResource)},this.$get=["$rootScope","$window","$q","$location","$timeout",function(n,t,i,a,c){function u(e,r){return r.requireADLogin?e.requireADLogin!==!1:!!e.requireADLogin}var s=function(){var i=t.location.hash;if(e.isCallback(i)){var u=e.getRequestInfo(i);if(e.saveTokenFromHash(u),a.$$html5?t.location=t.location.origin+t.location.pathname:t.location.hash="",u.requestType!==e.REQUEST_TYPE.LOGIN&&(e.callback=t.parent.AuthenticationContext().callback,u.requestType===e.REQUEST_TYPE.RENEW_TOKEN&&(e.callback=t.parent.callBackMappedToRenewStates[u.stateResponse])),u.stateMatch)if("function"==typeof e.callback){if(u.requestType===e.REQUEST_TYPE.RENEW_TOKEN){if(u.parameters.access_token)return void e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),u.parameters.access_token);if(u.parameters.id_token)return void e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),u.parameters.id_token)}}else o(e.config.loginResource),r.userName?(c(function(){o(e.config.loginResource),n.userInfo=r;var t=e._getItem(e.CONSTANTS.STORAGE.START_PAGE);if(t){var i=e._getItem(e.CONSTANTS.STORAGE.START_PAGE_PARAMS);if(i){var c=JSON.parse(i);a.url(t).search(c)}else a.url(t)}},1),n.$broadcast("adal:loginSuccess")):n.$broadcast("adal:loginFailure",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION))}else o(e.config.loginResource),e._renewActive||r.isAuthenticated||!r.userName||e._getItem(e.CONSTANTS.STORAGE.FAILED_RENEW)||e.acquireToken(e.config.loginResource,function(e,o){e?n.$broadcast("adal:loginFailure","auto renew failure"):o&&(r.isAuthenticated=!0)});c(function(){o(e.config.loginResource),n.userInfo=r},1)},l=function(){e.info("Login event for:"+a.$$url),e.config&&e.config.localLoginUrl?a.path(e.config.localLoginUrl):(e._saveItem(e.CONSTANTS.STORAGE.START_PAGE,a.$$url),e.info("Start login at:"+window.location.href),n.$broadcast("adal:loginRedirect"),e.login())},f=function(o,n){n&&n.$$route&&u(n.$$route,e.config)&&(r.isAuthenticated||(e.info("Route change event for:"+a.$$url),l()))},g=function(o,n,t,i,c){n&&u(n,e.config)&&(r.isAuthenticated||(a.$$url=n.url,e._saveItem(e.CONSTANTS.STORAGE.START_PAGE_PARAMS,JSON.stringify(t)),e.info("State change event for:"+a.$$url),l()))};return n.$on("$routeChangeStart",f),n.$on("$stateChangeStart",g),n.$on("$locationChangeStart",s),o(e.config.loginResource),n.userInfo=r,{config:e.config,login:function(){e.login()},loginInProgress:function(){return e.loginInProgress()},logOut:function(){e.logOut()},getCachedToken:function(r){return e.getCachedToken(r)},userInfo:r,acquireToken:function(r){var o=i.defer();return e.acquireToken(r,function(n,t){n?(e.error("Error when acquiring token for resource: "+r,n),o.reject(n)):o.resolve(t)}),o.promise},getUser:function(){var r=i.defer();return e.getUser(function(o,n){o?(e.error("Error when getting user",o),r.reject(o)):r.resolve(n)}),r.promise},getResourceForEndpoint:function(r){return e.getResourceForEndpoint(r)},clearCache:function(){e.clearCache()},clearCacheForResource:function(r){e.clearCacheForResource(r)},info:function(r){e.info(r)},verbose:function(r){e.verbose(r)}}}]}),e.factory("ProtectedResourceInterceptor",["adalAuthenticationService","$q","$rootScope",function(e,r,o){return{request:function(o){if(o){o.headers=o.headers||{};var n=e.getResourceForEndpoint(o.url);if(null===n)return o;var t=e.getCachedToken(n),i=!1;if(t)return e.info("Token is avaliable for this url "+o.url),o.headers.Authorization="Bearer "+t,o;if(e.config)for(var a in e.config.endpoints)o.url.indexOf(a)>-1&&(i=!0);if(e.loginInProgress())return e.info("login already start."),r.reject();if(e.config&&i){var c=r.defer();return e.acquireToken(n).then(function(r){e.verbose("Token is avaliable"),o.headers.Authorization="Bearer "+r,c.resolve(o)},function(e){c.reject(e)}),c.promise}return o}},responseError:function(n){if(e.info("Getting error in the response"),n&&401===n.status){var t=e.getResourceForEndpoint(n.config.url);e.clearCacheForResource(t),o.$broadcast("adal:notAuthorized",n,t)}return r.reject(n)}}}])}else console.error("Angular.JS is not included")}();